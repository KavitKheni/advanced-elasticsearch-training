# Logstash config for ingesting Childcare_Centres.csv

input { stdin { } }

filter {

  csv {
    autodetect_column_names => true
  }

      mutate {
        add_field => { "[geocode][type]" => "point" }
        add_field => { "[geocode][coordinates]" => ["%{[lon]}", "%{[lat]}"] }
      }

      # This converts all the array elements from strings to floats.
      mutate {
        convert => { "[geocode][coordinates]" => "float" }
      }
}

# output { stdout { codec => json } }

output {
  elasticsearch {
    manage_template => true
    template_overwrite => true
    template => "${TEMPLATE_PATH}"
    hosts => ["${ELASTICSEARCH_URL}"]
    index => "${INDEX}"
  }
}
